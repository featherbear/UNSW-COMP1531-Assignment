<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Your Order - GourmetBurgers</title>
	<link rel="icon" href="../assets/img/favicon.ico" type="image/x-icon" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link rel="stylesheet" type="text/css" media="screen" href="../assets/css/site.css" />
	<script src="../assets/js/site.js" defer></script>
	<script src="../assets/js/GourmetBurgers.js" defer></script>

</head>

<body>
	<div id="loading" class="no-select">
		<img src="../assets/img/logo-loading.svg" />
		<h1>Frying French Fries.<h1>
	</div>

	<header>
		<div class="container no-select">
			<a href="../cart">
				<div class="cart">Your Order: $<span name="orderTotal"></span></div>
			</a>
			<div class="logo"><a href=".."><img src="../assets/img/BURGAAAAA.svg" /></a></div>
			<div class="menu">
				<a href="../menu">Browse</a>
				<a href="../status">Order Status</a>
			</div>
		</div>
	</header>

	<div id="content" class="container">

		<style>
			#content {
				background-color: rgba(0, 0, 0, 0.4);
				padding: 15px;
				border-radius: 15px;
			}

			h1,
			p,
			div {
				color: white;
			}

			#orderItems>div {
				margin-bottom: 15px;
			}

			.ingredients span {
				display: block;
				font-style: italic;
			}

			#submit {
				font-size: 24px;
			}

			div[name=section-error]:not(.active) {
				display: none
			}

			div[name=section-error].active~div[name=section-data] {
				display: none;
			}

			a,
			a:visited {
				color: white;
			}
		</style>
		<h1>Order Summary</h1>

		<div name="section-error">
			<p>There are no items in your cart!<p>
					Click <a href="../menu">here</a> to browse the menu
		</div>
		<div name="section-data">
			<p>Below are the details of your order:</p>

			<h3>Total: $<span id="totalPrice"></span></h3>

			<div id="orderItems">

			</div>

			</br>

			<td align="center">
				<button id="submit" type="submit">Place Order</button>
			</td>
		</div>

		<script>
			function ready() {
				if (GourmetBurgers.cart._data.length == 0) {
					document.querySelector('div[name=section-error]').classList.add('active');
					return;
				}
				let total = 0;
				for (item of GourmetBurgers.cart._data) {
					container = document.createElement('div');
					let price = GourmetBurgers.cart._calculate(item);
					total += price * item.qty;
					nameElement = document.createElement('span');
					nameElement.innerText = `${item.qty}x ${GourmetBurgers._menu[item.id].name} ($${priceToDecimal(price)})`;
					container.appendChild(nameElement)
					if (item.custom) {
						ingredientContainer = document.createElement('div');
						ingredientContainer.classList.add('ingredients');
						for (let ingredientID in item.items) {
							ingredientElem = document.createElement('span');
							quantity = item.items[ingredientID];
							if (quantity == 0) continue;
							name = GourmetBurgers._inventory[ingredientID].name;
							suffix = GourmetBurgers._inventory[ingredientID].suffix;
							ingredientElem.innerText = `${quantity}${suffix} ${name}`;
							ingredientContainer.appendChild(ingredientElem)
						}
						container.appendChild(ingredientContainer);
					}
					document.getElementById("orderItems").appendChild(container);
				}
				document.getElementById('totalPrice').innerText = priceToDecimal(total);
				document.getElementById('submit').addEventListener('click', async function() {
					let json = await GourmetBurgers.cart.submitOrder();
					console.log(json);
					if (json.url) location.href = json.url;
				})
				updateTotal();
			}
		</script>
	</div>

	<footer>
		<div class="container">
			<div class="greybox">
				<span class="staff no-select"><a href="../staff/inventory">Staff Inventory</a> | <a href="../staff/orders">Staff Orders</a></span>
				<ul>
					<li>z5142003</li>
					<li>z5206677</li>
					<li>z5210581</li>
				</ul>
			</div>
		</div>
	</footer>
</body>

</html>